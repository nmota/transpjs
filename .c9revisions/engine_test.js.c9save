{"ts":1364176030290,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"function trafficSimulation (FLIGHT_TIME, TURN_TIME, SIMTIME,SEED,LAMBDA) {\n\tvar sim = new Sim();\n\tvar stats = new Sim.Population();\n\t\n\t// Estrutura eventual para um sistemas de eventos em vez de mensagens usado agora para manter registo da localiza��o do avi�o\n\tvar Location = [\"Corvo\",\n\t\t\t\t\t\"Faial\"\n\t\t\t\t\t];\n\t\t\t\t\t\n\t// Buffers array para as Gares, tempor�rio at� se mudar a l�gica do passenger dispatcher\t\t\t\t\n\tvar gBuffers = new Array();\n\t\n\t//Necess�rio para a l�gica atual de hor�rio, a eliminar\n\tvar gGare = new Array();\n\t\n\t//Buffers das Gares no final dever�o existir 72 buffers destes..\n\tvar Gare1 = new Sim.Buffer(\"Gare do Corvo\",1000);\n\tvar Gare2 = new Sim.Buffer(\"Gare do Faial\",1500);\n\t\n\t// Buffers array para as Gares, tempor�rio at� se mudar a l�gica do passenger dispatcher\n\tgBuffers[0]=Gare1;\n\tgBuffers[1]=Gare2;\n\t\n\t// Buffer do Avi�o -- no final cada avi�o dever� ter 9 buffers....\n\tvar Plane1 = new Sim.Buffer(\"Q200_1\",30);\n\t\n\t// Varii�vel aleat�ria;\n\tvar random = new Random(SEED);\n\t\n\t//Controlo da prioritiza��o de transporte -- esta fun��o dever� aumentar de complexidade muito rapidamente\t\n\tfunction passDispatcher (plane_BUFFER,gare_BUFFER) {\n\t\tvar nPassTravel = 0;\n\t\tnPassTravel = Math.min(plane_BUFFER.size()-plane_BUFFER.current(),gare_BUFFER.current());\n\t\treturn nPassTravel;\n\t};\t\n\t\n\t//Entidade das Gares\n\tvar Gare = {\n\t\tstart: function () {\n\t\t//document.write(\"Gare do \" +this.name+\" est� aberta <br>\");\n\t\t},\n\t\tonMessage: function (sender,message) {\n\t\t//Receive message and schedule reply\n\t\tdocument.write(\"Avi�o est� no \" + this.name + \"<br>\");\n\t\t//Empty th plane\n\t\tthis.getBuffer(sender.buff,sender.buff.current());\n\t\t//schedule new message for take off\n\t\tvar newMessage = \"Runway clear <br>\";\n\t\tthis.send(newMessage,TURN_TIME,sender);\n\t\t}\n\t};\n\t\t\n\tvar Q200 = {\n\t\tcurrentLocation: 0, //the location of the plane \n\t\tstart: function () {\n\t\t\t//send start message - - deve mudar para acomodar diferentes locais de come�o\n\t\t\tvar aMessage = \"Aterrei\" + Location[this.currentLocation].name;\n\t\t\tthis.send(aMessage,0,gCorvo);\n\t\t\tdocument.write(\"Primeira aterragem no \"+  Location[this.currentLocation].name + \" <br>\");\n\t\t},\n\t\tonMessage: function (sender, message) {\n\t\t\t//receive messagem and procede with the take off and landing cycle\n\t\t\t//take off\n\t\t\tdocument.write(sender.name + \"'s Runway clear <br>\");\t\n\t\t    document.write(\"Mensagem recebida, over <br>\");\n\t\t\t//embarcar passageiros\n\t\t\tpassEmbarca = passDispatcher(this.buff, sender.buff);\n\t\t\tthis.putBuffer(this.buff,passEmbarca);\n\t\t\t//Logging\n\t\t\tdocument.write(\"Avi�o tem \" + Plane1.current()+\"<br>\");\n\t\t\tdocument.write(\"Avi�o est� no ar <br>\");\n\t\t\t//Tirar passageiros da Gare\n\t\t\tthis.getBuffer(sender.buff,passEmbarca);\n\t\t\t//landing procedure\n\t\t\tthis.currentLocation = 1 - this.currentLocation;\n\t\t\tvar aMessage = \"Aterrei\" + Location[this.currentLocation].name;\n\t\t\tthis.send(aMessage,FLIGHT_TIME,gGare[this.currentLocation]);\t\t\n\t\t}\n\t};\t\n\t\t\n\tvar centralReservas = {\n\t\tstart: function () {\n\t\t\tvar nextReserv = random.exponential(LAMBDA);\n\t\t\tthis.putBuffer(gBuffers[0],1);\n\t\t\tdocument.write(\"\"+gBuffers[0].current()+\"<br>\");\n\t\t\tthis.putBuffer(gBuffers[1],1);\n\t\t\tthis.setTimer(nextReserv).done(this.start);\n\t\t}\n\t};\n\n\t// Adicionar as primeiras entidade, central de resercas e Gares - Ordem � importante\n\tvar Reservas = sim.addEntity(centralReservas);\n\tvar gCorvo = sim.addEntity(Gare);\n\tvar gFaial = sim.addEntity(Gare);\n\t\n\t//Extend entitys properties\n\tgCorvo.name = \"Corvo\";\n\tgFaial.name = \"Faial\";\n\tgCorvo.buff = Gare1;\n\tgFaial.buff = Gare2;\n\t\n\tgGare[0]=gCorvo;\n\tgGare[1]=gFaial; \n\t\n\t// Adicionar avi�es ao sistema e extender as suas propriedades\n\tvar Q200_1 = sim.addEntity(Q200);\n\tQ200_1.name =\"Q200\";\n\tQ200_1.buff = Plane1;\n\t\n\tsim.setLogger(function (str) {\n\t\tdocument.write(str);\n\t});\n\t\t\n\tsim.simulate(SIMTIME);\n}\t"]],"start1":0,"start2":0,"length1":0,"length2":3788}]],"length":3788}
